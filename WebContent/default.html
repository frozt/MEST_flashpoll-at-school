<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
		<script src="js/mobiscroll.custom-2.6.2.min.js" type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="css/mobiscroll.custom-2.6.2.min.css" /> 
        <link href="css/style.css" rel="stylesheet">
        <script type="text/javascript">
        $(document).ready(function() {   
        	 var results;
            $('#submit').click(function(event) {  
            	var pollId = $('#poll_id').val(); 
            	if(numberCheck(pollId)) {
            		var createPoll = "createPoll";
                    $.get('PollServlet',{poll:pollId,requestType:createPoll},function(responseText) { 
                           $(responseText).insertAfter('#occupation');
                        });
                    if(typeof(Storage)!=="undefined") {
        	              localStorage.poll_id=pollId;
        	        }
                    window.location = '#gender';
            	}
            	else {
            		alert("Please enter a valid number");
                    $('#poll_id').val('');
            	}
            });         
           
        });
		/*	$(function(){
		    $('#birthday').mobiscroll().date({
		        theme: 'ios',
		        display: 'bottom',
		        mode: 'scroller',
		        dateOrder: 'D ddmmyy'
		    });    
		   });    */
			function saveUser() {
				var mail=localStorage.email;
				var gender = $('input[name=gender]').filter(':checked').val();
				var age = $('#ageBox').val();
				var occupation = $('#occupt').val();
				$.post('UserServlet',{email:mail, gender:gender, age:age, occupation:occupation},function(data) {
					//alert(data);
				});
				window.location = '#question1';				
			}
			
			var pageNumber=1,
        	results = [];
        function nextPage(isFinalPage) {
            var contents = $("#question" + pageNumber).find(".answers"),
                ranger = $("#question" + pageNumber).find(".ranger");

            results.push("question" + pageNumber);
            contents.filter(":checked").each(function () {
                var text = $(this).next().find("span.ui-btn-text").text();
                if (text == undefined || text == "") {
                    text = $(this).parent().next().text();
                }
                results.push(text);
            });
            contents.filter("textarea").each(function () {
                results.push($(this).val());
            });

            ranger.each(function () {
                if ($(this).attr("disabled") !== "disabled") {
                    results.push($(this).val());
                }
            });
            if (isFinalPage) {

                var mail=localStorage.email;
                var pollId = localStorage.poll_id;
                var answers = results.join(";");
                $.post('PollServlet',{email:mail, pollId:pollId, answers:answers},function(data) {
					//alert(data);
				}); 
                window.location = '#final';
                return;
            }
            else {
            	pageNumber += 1;
                window.location = '#question' + pageNumber;
            }
        }
        
        function prevPage() {
        	pageNumber -= 1;
            var startingPoint = results.indexOf("question"+pageNumber);
            results.splice(startingPoint,results.length - startingPoint);
            window.location = '#question' +pageNumber;
        }
        function ageCheck () {
        	if(!numberCheck($('#ageBox').val())) {
        		alert("Enter a valid number.");
        		$('#ageBox').val('');
        	}
        }
        function numberCheck (value) 
        {
            if(value < 1 || isNaN(value)) {
                return false;
            }
            if (value >0)
            	return true;
        }
        </script>

<meta http-equiv=Content-Type content=text/html;charset=iso-8859-1 />
<title>MEST</title>
</head>
<body>
<div data-role="page" id="welcome">
            <div data-role="header">
                <h1>Flashpoll@Schools</h1>
            </div>
            <div data-role="content">
	            <div data-role="fieldcontain">
		            <label for="poll_id">Enter Poll ID:</label>
		            <input type="number" id="poll_id" min="1"/>
	            </div>
	            <div class="button">
	            	<input type="button" id="submit" value="Start"/>
	            </div>
            </div>
</div>
<div data-role="page" id="gender">
        <div data-role="header">
            <h1>Flashpoll@Schools</h1>
        </div>
        <div data-role="content">
            <div data-role="fieldcontain">
            <fieldset data-role="controlgroup" data-type="horizontal">
			        <legend>Gender:</legend>
			        <input type="radio" name="gender" id="male" value="male">
			        <label for="male">Male</label>
			        <input type="radio" name="gender" id="female" value="female">
			        <label for="female">Female</label>
	    	</fieldset>
	    	<fieldset class="ui-grid-a">
			    <div class="ui-block-a"></div>
			    <div class="ui-block-b"><input type="button" value="Next" data-theme="b" onclick="window.location = '#age'; "></div>
			</fieldset>
	    	</div>  
	    </div>
</div>    
<div data-role="page" id="age">
        <div data-role="header">
            <h1>Flashpoll@Schools</h1>
        </div>
        <div data-role="content">
            <div data-role="fieldcontain">
			    <label for="ageBox">Your age:</label>
	    		<input type="number" name="birthday" id="ageBox" required onchange="ageCheck();"/>
	    	
	    	<fieldset class="ui-grid-a">
			    <div class="ui-block-a"><input type="button" value="Previous" data-theme="b" onclick="window.location = '#gender'; "></div>
			    <div class="ui-block-b"><input type="button" value="Next" data-theme="b" onclick="window.location = '#occupation'; "></div>
			</fieldset>
	    	</div>  
	    </div>
</div> 
<div data-role="page" id="occupation">
        <div data-role="header">
            <h1>Flashpoll@Schools</h1>
        </div>
        <div data-role="content">
            <div data-role="fieldcontain">
            <label for="occupt">Occupation: </label>
	        <input type="text" id="occupt"><br>  
	    	<fieldset class="ui-grid-a">
			    <div class="ui-block-a"><input type="button" value="Previous" data-theme="b" onclick="window.location = '#age'; "></div>
			    <div class="ui-block-b"><input type="button" value="Next" data-theme="b" onclick="saveUser()"></div>
			</fieldset>
	    	</div>  
	    </div>
</div>
</body>
</html>
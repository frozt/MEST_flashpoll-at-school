<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
		<script src="js/mobiscroll.custom-2.6.2.min.js" type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="css/mobiscroll.custom-2.6.2.min.css" /> 
        <link href="css/style.css" rel="stylesheet">
        <script>
            $(document).ready(function() { 
                $('#submit').click(function(event) {
                	var pollId = $('#poll_id').val();
                	if(minValueCheck(pollId)) {
		                var createPoll = "createPoll";
		                $.get('PollServlet',{requestType:createPoll,poll:pollId},function(responseText) { 
		                       $(responseText).insertAfter('#question');
		                    });
		                if(typeof(Storage)!=="undefined") {
				              localStorage.poll_id=pollId;
				        }
		                window.location = '#question';
		            	window.location = '#question1';  
                	}
            	});
            });
            var pageNumber=1,
            	results = [];
            function nextPage(isFinalPage) {
                var contents = $("#question" + pageNumber).find(".answers"),
                    ranger = $("#question" + pageNumber).find(".ranger");

                results.push("question" + pageNumber);
                contents.filter(":checked").each(function () {
                    var text = $(this).next().find("span.ui-btn-text").text();
                    if (text == undefined || text == "") {
                        text = $(this).parent().next().text();
                    }
                    results.push(text);
                });
                contents.filter("textarea").each(function () {
                    results.push($(this).val());
                });

                ranger.each(function () {
                    if ($(this).attr("disabled") !== "disabled") {
                        results.push($(this).val());
                    }
                });
                if (isFinalPage) {

                    var mail=localStorage.email;
                    var pollId = localStorage.poll_id;
                    var answers = results.join(";");
                    $.post('PollServlet',{email:mail, pollId:pollId, answers:answers},function(data) {
    					//alert(data);
    				}); 
                    window.location = '#final';
                    return;
                }
                else {
                	pageNumber += 1;
	                window.location = '#question' + pageNumber;
                }
            }
            
            function prevPage() {
            	pageNumber -= 1;
                var startingPoint = results.indexOf("question"+pageNumber);
                results.splice(startingPoint,results.length - startingPoint);
                window.location = '#question' +pageNumber;
            }
            
            function minValueCheck (value) 
            {
                if(value < 1 || isNaN(value)) {
                    alert("Please enter a valid number");
                    $('#poll_id').val('');
                    return false;
                }
                if (value >0)
                	return true;
            }
          
        </script>

<meta charset="ISO-8859-1">
<title>MEST</title>
</head>
<body>
<div data-role="page" id="welcome">
            <div data-role="header">
                <h1>Flashpoll@Schools</h1>
            </div>
            <div data-role="content">
	            <div data-role="fieldcontain">
		            <label for="poll_id">Enter Poll ID:</label>
		            <input type="number" id="poll_id" min="1"/>
		        </div>
		        <div class="button">
		            <input type="button" id="submit" value="Start" />
	            </div>
            </div>
</div>
<div data-role="page" id="question">

</div>

</body>
</html>